import{_ as r,D as t,c as o,I as e,w as a,aa as l,o as c,l as i,a as s}from"./chunks/framework.B-_8KZRP.js";const T=JSON.parse('{"title":"Optimistic Concurrency","description":"","frontmatter":{"head":[["link",{"rel":"canonical","href":"https://pointw-dev.github.io/halchemy/guide/concurrency/using.html"}]]},"headers":[],"relativePath":"guide/concurrency/using.md","filePath":"guide/concurrency/using.md"}'),E={name:"guide/concurrency/using.md"},d=l('<h1 id="optimistic-concurrency" tabindex="-1">Optimistic Concurrency <a class="header-anchor" href="#optimistic-concurrency" aria-label="Permalink to &quot;Optimistic Concurrency&quot;">​</a></h1><h2 id="requesting-changes" tabindex="-1">Requesting changes <a class="header-anchor" href="#requesting-changes" aria-label="Permalink to &quot;Requesting changes&quot;">​</a></h2><p>Between the time you <code>GET</code> a resource then make a request which would change it (<code>PUT</code>, <code>PATCH</code>, <code>DELETE</code>), the resource might have been changed by someone else. Without some mechanism in place, this means multiple concurrent users would step on each others toes, overwriting each other&#39;s changes without knowing.</p><p>A mechanism to protect against this used by many APIs is called &quot;optimistic concurrency&quot;. This means optimistically assuming no one else has concurrently changed the resource since your <code>GET</code> request, - hence the term. If someone <em>has</em> changed the resource in the meantime, the server rejects the newer change with a <code>412 Precondition Failed</code> response.</p>',4),p=i("div",{class:"language-python vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"python"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"customer "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," api.follow(customers).to("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'item'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},").with_template_values({"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'customerId'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'A375'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}).get()")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"customer "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," api.follow(customer).to("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'self'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},").patch({"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'givenName'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'Leslie'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"})")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," customer._halchemy.response.status_code "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 412"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    print"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"f"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'Someone else has changed customer #"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"{"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"customer["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"customerId"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},".'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    print"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'Please refresh to see the changes, then try again if necessary.'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])])],-1),g=i("div",{class:"language-javascript vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"javascript"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," customer "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," await"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," api."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"follow"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(customers)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"to"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'item'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"withTemplateValues"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"({"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'customerId'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'A375'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"})")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"customer "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," await"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," api."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"follow"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(customer)."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"to"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'self'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"patch"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"({"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'givenName'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'Leslie'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"})")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (customer._halchemy.response.status "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"==="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 412"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`Someone else has changed customer #${"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"customer"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"customerId"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"]"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"}.`"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'Please refresh to see the changes, then try again if necessary.'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])])],-1),y=l('<h2 id="how-it-works" tabindex="-1">How it works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How it works&quot;">​</a></h2><ol><li>You <code>GET</code> a resource and receive its current state.</li><li>The resource will have an ETag which is a unique identifier for the resource&#39;s current state.</li><li>When you make a request to change the resource, you include the header <code>If-Match</code> with the ETag value.</li><li>If the ETag matches, the server will apply the change and return a <code>200 OK</code> response.</li><li>If the resource has been changed by someone else, the server will return a <code>412 Precondition Failed</code> response.</li></ol><p>What your application does with a <code>412 Precondition Failed</code> is up to you. You could:</p><ul><li>Inform the user that the resource has been changed and ask them to refresh the page.</li><li>Automatically refresh the resource and apply the change again.</li><li>Merge the changes together.</li><li>Reject the change.</li><li>Ask the user to resolve the conflict.</li><li>etc.</li></ul><h2 id="how-halchemy-helps" tabindex="-1">How halchemy helps <a class="header-anchor" href="#how-halchemy-helps" aria-label="Permalink to &quot;How halchemy helps&quot;">​</a></h2><p>Halchemy automates steps 2. and 3. When you follow a resource to <code>self</code> to make a change request (<code>PUT</code>, <code>PATCH</code>, <code>DELETE</code>), halchemy automatically puts the ETag in the request&#39;s <code>If-Match</code> header.</p><p>Usually the Etag comes from the response&#39;s <code>ETag</code> header, and halchemy looks there first. Some APIs include the ETag in one of the resource&#39;s fields. If halchemy does not find the <code>ETag</code> header, it looks next for a field named <code>_etag</code>. You can change the name of the field halchemy looks for by setting the &quot;etag field&quot; in the <code>Api</code> object.</p><p>See <a href="./../configuration/properties.html">Configuration</a> for more information on configuring halchemy.</p>',8);function u(F,m,f,C,_,B){const h=t("tab"),n=t("future-languages"),k=t("tabs");return c(),o("div",null,[d,e(k,null,{default:a(()=>[e(h,{name:"Python"},{default:a(()=>[p]),_:1}),e(h,{name:"JavaScript"},{default:a(()=>[g]),_:1}),e(n)]),_:1}),y])}const A=r(E,[["render",u]]);export{T as __pageData,A as default};
